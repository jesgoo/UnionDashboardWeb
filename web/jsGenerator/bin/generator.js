var _ = require('underscore');
var UglifyJS = require('uglify-js2');
var PropertyConfig = require('../js/propertyConfig');
var properties = require('../js/properties');
var propertyList = require('../js/propertyList');
var layoutList = require('../js/layoutList');
var generator = require('../js/generator');
_.mixin(require('./template_extend')(_));
_.mixin(require('underscore.deep'));

process.stdin.setEncoding('utf8');

var originalData = [];
process.stdin.on('readable', function () {
    var chunk = process.stdin.read();
    if (chunk !== null) {
        originalData.push(chunk);
    }
});

var maps = {
    "adType": {
        "text": 1,
        "image": 2,
        "html": 3,
        "video": 4,
        "text_icon": 5
    },
    "adTypeMap": {
        "1": "text",
        "2": "image",
        "3": "html",
        "4": "video",
        "5": "text_icon"
    }
};

var g = function (data) {
    var adType = data.adtype;
    adType === 1 && (adType = 5);
    var adTypeName = maps.adTypeMap[adType];

    var templateData = data.json || {};
    var scale = templateData.scale || {};
    var property = propertyList[adTypeName](properties);
    property = _.deepClone(property);
    var layoutData = layoutList[adTypeName](scale);
    var contentProperty = new PropertyConfig(property, templateData.content);
    var contentData = contentProperty.getData();
    return generator(adTypeName, contentData, layoutData, templateData.scale);

};


process.stdin.on('end', function () {
    var data = JSON.parse(originalData.join(''));
    var customJS = g(data);
    if (!process.env.SOURCE) {
        customJS = UglifyJS.minify(customJS, {
            fromString: true
        }).code;
    }
    process.stdout.write('// jesgoo\n;');
    process.stdout.write(customJS);
    process.stdout.write('\n;// jesgoo\n');
    process.exit();
});

process.on('uncaughtException', function(err) {
    process.stderr.write('Caught exception: ' + err);
    process.exit();
});

/*var js = g({"adType":5,"percent":80,"jsSource":"result.js","data":{"content":{"iconArea":{"backgroundColor":{"color":"#60cb1b","opacity":"0"},"transform":{"translate_x":"0","translate_y":"0","rotate_x":"0","rotate_y":"0","rotate_z":"0","skew":"0","scale":"100"},"animate":{"duration":"0","timing_function":"ease-in-out","delay":"0","iteration_count":"0","direction":"alternate","fames":"from {-webkit-transform:translateY(-2em) scale(0.3);;background: rgba(96, 203, 27,0.5);-webkit-box-shadow: 0 0 5px rgba(255, 255, 255, 0.3) inset, 0 0 3px rgba(220, 120, 200, 0.5);color: red; }25% {background: rgba(196, 203, 27,0.8);-webkit-box-shadow: 0 0 10px rgba(255, 155, 255, 0.5) inset, 0 0 8px rgba(120, 120, 200, 0.8);color: blue;}50% {-webkit-transform:scale(0.8);background: rgba(196, 203, 127,1);-webkit-box-shadow: 0 0 5px rgba(155, 255, 255, 0.3) inset, 0 0 3px rgba(220, 120, 100, 1);color: orange;}75% {background: rgba(196, 203, 27,0.8);-webkit-box-shadow: 0 0 10px rgba(255, 155, 255, 0.5) inset, 0 0 8px rgba(120, 120, 200, 0.8);color: black;}to {-webkit-transform:translateY(2em) scale(0.5);;background: rgba(96, 203, 27,0.5);-webkit-box-shadow: 0 0 5px rgba(255, 255, 255, 0.3) inset, 0 0 3px rgba(220, 120, 200, 0.5);color: green;}"}},"textArea":{"backgroundColor":{"color":"#60cb1b","opacity":"0"},"transform":{"translate_x":"0","translate_y":"0","rotate_x":"0","rotate_y":"0","rotate_z":"0","skew":"0","scale":"100"},"animate":{"duration":"0","timing_function":"ease-in-out","delay":"0","iteration_count":"0","direction":"alternate","fames":"from {-webkit-transform:translateY(-2em) scale(0.3);;background: rgba(96, 203, 27,0.5);-webkit-box-shadow: 0 0 5px rgba(255, 255, 255, 0.3) inset, 0 0 3px rgba(220, 120, 200, 0.5);color: red; }25% {background: rgba(196, 203, 27,0.8);-webkit-box-shadow: 0 0 10px rgba(255, 155, 255, 0.5) inset, 0 0 8px rgba(120, 120, 200, 0.8);color: blue;}50% {-webkit-transform:scale(0.8);background: rgba(196, 203, 127,1);-webkit-box-shadow: 0 0 5px rgba(155, 255, 255, 0.3) inset, 0 0 3px rgba(220, 120, 100, 1);color: orange;}75% {background: rgba(196, 203, 27,0.8);-webkit-box-shadow: 0 0 10px rgba(255, 155, 255, 0.5) inset, 0 0 8px rgba(120, 120, 200, 0.8);color: black;}to {-webkit-transform:translateY(2em) scale(0.5);;background: rgba(96, 203, 27,0.5);-webkit-box-shadow: 0 0 5px rgba(255, 255, 255, 0.3) inset, 0 0 3px rgba(220, 120, 200, 0.5);color: green;}"}},"textTitleArea":{"text_align":"Center","backgroundColor":{"color":"#60cb1b","opacity":"0"},"transform":{"translate_x":"0","translate_y":"0","rotate_x":"0","rotate_y":"0","rotate_z":"0","skew":"0","scale":"100"},"animate":{"duration":"0","timing_function":"ease-in-out","delay":"0","iteration_count":"0","direction":"alternate","fames":"from {-webkit-transform:translateY(-2em) scale(0.3);;background: rgba(96, 203, 27,0.5);-webkit-box-shadow: 0 0 5px rgba(255, 255, 255, 0.3) inset, 0 0 3px rgba(220, 120, 200, 0.5);color: red; }25% {background: rgba(196, 203, 27,0.8);-webkit-box-shadow: 0 0 10px rgba(255, 155, 255, 0.5) inset, 0 0 8px rgba(120, 120, 200, 0.8);color: blue;}50% {-webkit-transform:scale(0.8);background: rgba(196, 203, 127,1);-webkit-box-shadow: 0 0 5px rgba(155, 255, 255, 0.3) inset, 0 0 3px rgba(220, 120, 100, 1);color: orange;}75% {background: rgba(196, 203, 27,0.8);-webkit-box-shadow: 0 0 10px rgba(255, 155, 255, 0.5) inset, 0 0 8px rgba(120, 120, 200, 0.8);color: black;}to {-webkit-transform:translateY(2em) scale(0.5);;background: rgba(96, 203, 27,0.5);-webkit-box-shadow: 0 0 5px rgba(255, 255, 255, 0.3) inset, 0 0 3px rgba(220, 120, 200, 0.5);color: green;}"}},"textTitleText":{"font":{"fontSize":"12","lineHeight":"110","fontFamily":"Microsoft Yahei","color":"#000000"},"backgroundColor":{"color":"#60cb1b","opacity":"0"},"transform":{"translate_x":"0","translate_y":"0","rotate_x":"0","rotate_y":"0","rotate_z":"0","skew":"0","scale":"100"}},"textDescriptionArea":{"text_align":"Center","backgroundColor":{"color":"#60cb1b","opacity":"0"},"transform":{"translate_x":"0","translate_y":"0","rotate_x":"0","rotate_y":"0","rotate_z":"0","skew":"0","scale":"100"},"animate":{"duration":"0","timing_function":"ease-in-out","delay":"0","iteration_count":"0","direction":"alternate","fames":"from {-webkit-transform:translateY(-2em) scale(0.3);;background: rgba(96, 203, 27,0.5);-webkit-box-shadow: 0 0 5px rgba(255, 255, 255, 0.3) inset, 0 0 3px rgba(220, 120, 200, 0.5);color: red; }25% {background: rgba(196, 203, 27,0.8);-webkit-box-shadow: 0 0 10px rgba(255, 155, 255, 0.5) inset, 0 0 8px rgba(120, 120, 200, 0.8);color: blue;}50% {-webkit-transform:scale(0.8);background: rgba(196, 203, 127,1);-webkit-box-shadow: 0 0 5px rgba(155, 255, 255, 0.3) inset, 0 0 3px rgba(220, 120, 100, 1);color: orange;}75% {background: rgba(196, 203, 27,0.8);-webkit-box-shadow: 0 0 10px rgba(255, 155, 255, 0.5) inset, 0 0 8px rgba(120, 120, 200, 0.8);color: black;}to {-webkit-transform:translateY(2em) scale(0.5);;background: rgba(96, 203, 27,0.5);-webkit-box-shadow: 0 0 5px rgba(255, 255, 255, 0.3) inset, 0 0 3px rgba(220, 120, 200, 0.5);color: green;}"}},"textDescriptionText":{"font":{"fontSize":"12","lineHeight":"110","fontFamily":"Microsoft Yahei","color":"#000000"},"backgroundColor":{"color":"#60cb1b","opacity":"0"},"transform":{"translate_x":"0","translate_y":"0","rotate_x":"0","rotate_y":"0","rotate_z":"0","skew":"0","scale":"100"}},"btnArea":{"text_align":"Center","backgroundColor":{"color":"#60cb1b","opacity":"0"},"transform":{"translate_x":"0","translate_y":"0","rotate_x":"0","rotate_y":"0","rotate_z":"0","skew":"0","scale":"100"},"animate":{"duration":3,"timing_function":"ease-in-out","delay":"0","iteration_count":"0","direction":"alternate","fames":"from {-webkit-transform:translateY(-2em) scale(0.3);;background: rgba(96, 203, 27,0.5);-webkit-box-shadow: 0 0 5px rgba(255, 255, 255, 0.3) inset, 0 0 3px rgba(220, 120, 200, 0.5);color: red; }25% {background: rgba(196, 203, 27,0.8);-webkit-box-shadow: 0 0 10px rgba(255, 155, 255, 0.5) inset, 0 0 8px rgba(120, 120, 200, 0.8);color: blue;}50% {-webkit-transform:scale(0.8);background: rgba(196, 203, 127,1);-webkit-box-shadow: 0 0 5px rgba(155, 255, 255, 0.3) inset, 0 0 3px rgba(220, 120, 100, 1);color: orange;}75% {background: rgba(196, 203, 27,0.8);-webkit-box-shadow: 0 0 10px rgba(255, 155, 255, 0.5) inset, 0 0 8px rgba(120, 120, 200, 0.8);color: black;}to {-webkit-transform:translateY(2em) scale(0.5);;background: rgba(96, 203, 27,0.5);-webkit-box-shadow: 0 0 5px rgba(255, 255, 255, 0.3) inset, 0 0 3px rgba(220, 120, 200, 0.5);color: green;}"}},"btnContent":{"content":"看一看","font":{"fontSize":"12","lineHeight":"110","fontFamily":"Microsoft Yahei","color":"#000000"},"backgroundColor":{"color":"#60cb1b","opacity":"0"},"transform":{"translate_x":"0","translate_y":"0","rotate_x":"0","rotate_y":"0","rotate_z":"0","skew":"0","scale":"100"}}},"scale":{"from":75,"to":352,"layout":{"iconArea":2,"textArea":1,"btnArea":0}}},"json":{"content":{"iconArea":{"backgroundColor":{"color":"#60cb1b","opacity":"0"},"transform":{"translate_x":"0","translate_y":"0","rotate_x":"0","rotate_y":"0","rotate_z":"0","skew":"0","scale":"100"},"animate":{"duration":"0","timing_function":"ease-in-out","delay":"0","iteration_count":"0","direction":"alternate","fames":"from {-webkit-transform:scale(0.5);;background: rgba(96, 203, 27,0.5);-webkit-box-shadow: 0 0 5px rgba(255, 255, 255, 0.3) inset, 0 0 3px rgba(220, 120, 200, 0.5);color: red; }25% {background: rgba(196, 203, 27,0.8);-webkit-box-shadow: 0 0 10px rgba(255, 155, 255, 0.5) inset, 0 0 8px rgba(120, 120, 200, 0.8);color: blue;}50% {background: rgba(196, 203, 127,1);-webkit-box-shadow: 0 0 5px rgba(155, 255, 255, 0.3) inset, 0 0 3px rgba(220, 120, 100, 1);color: orange;}75% {background: rgba(196, 203, 27,0.8);-webkit-box-shadow: 0 0 10px rgba(255, 155, 255, 0.5) inset, 0 0 8px rgba(120, 120, 200, 0.8);color: black;}to {-webkit-transform:scale(1.1);;background: rgba(96, 203, 27,0.5);-webkit-box-shadow: 0 0 5px rgba(255, 255, 255, 0.3) inset, 0 0 3px rgba(220, 120, 200, 0.5);color: green;}"}},"textArea":{"backgroundColor":{"color":"#60cb1b","opacity":"0"},"transform":{"translate_x":"0","translate_y":"0","rotate_x":"0","rotate_y":"0","rotate_z":"0","skew":"0","scale":"100"},"animate":{"duration":"0","timing_function":"ease-in-out","delay":"0","iteration_count":"0","direction":"alternate","fames":"from {-webkit-transform:scale(0.5);;background: rgba(96, 203, 27,0.5);-webkit-box-shadow: 0 0 5px rgba(255, 255, 255, 0.3) inset, 0 0 3px rgba(220, 120, 200, 0.5);color: red; }25% {background: rgba(196, 203, 27,0.8);-webkit-box-shadow: 0 0 10px rgba(255, 155, 255, 0.5) inset, 0 0 8px rgba(120, 120, 200, 0.8);color: blue;}50% {background: rgba(196, 203, 127,1);-webkit-box-shadow: 0 0 5px rgba(155, 255, 255, 0.3) inset, 0 0 3px rgba(220, 120, 100, 1);color: orange;}75% {background: rgba(196, 203, 27,0.8);-webkit-box-shadow: 0 0 10px rgba(255, 155, 255, 0.5) inset, 0 0 8px rgba(120, 120, 200, 0.8);color: black;}to {-webkit-transform:scale(1.1);;background: rgba(96, 203, 27,0.5);-webkit-box-shadow: 0 0 5px rgba(255, 255, 255, 0.3) inset, 0 0 3px rgba(220, 120, 200, 0.5);color: green;}"}},"textTitleArea":{"text_align":"Center","backgroundColor":{"color":"#60cb1b","opacity":"0"},"transform":{"translate_x":"0","translate_y":"0","rotate_x":"0","rotate_y":"0","rotate_z":"0","skew":"0","scale":"100"},"animate":{"duration":"0","timing_function":"ease-in-out","delay":"0","iteration_count":"0","direction":"alternate","fames":"from {-webkit-transform:scale(0.5);;background: rgba(96, 203, 27,0.5);-webkit-box-shadow: 0 0 5px rgba(255, 255, 255, 0.3) inset, 0 0 3px rgba(220, 120, 200, 0.5);color: red; }25% {background: rgba(196, 203, 27,0.8);-webkit-box-shadow: 0 0 10px rgba(255, 155, 255, 0.5) inset, 0 0 8px rgba(120, 120, 200, 0.8);color: blue;}50% {background: rgba(196, 203, 127,1);-webkit-box-shadow: 0 0 5px rgba(155, 255, 255, 0.3) inset, 0 0 3px rgba(220, 120, 100, 1);color: orange;}75% {background: rgba(196, 203, 27,0.8);-webkit-box-shadow: 0 0 10px rgba(255, 155, 255, 0.5) inset, 0 0 8px rgba(120, 120, 200, 0.8);color: black;}to {-webkit-transform:scale(1.1);;background: rgba(96, 203, 27,0.5);-webkit-box-shadow: 0 0 5px rgba(255, 255, 255, 0.3) inset, 0 0 3px rgba(220, 120, 200, 0.5);color: green;}"}},"textTitleText":{"font":{"fontSize":18,"lineHeight":"110","fontFamily":"Microsoft Yahei","color":"#000000"},"backgroundColor":{"color":"#60cb1b","opacity":"0"},"transform":{"translate_x":"0","translate_y":"0","rotate_x":"0","rotate_y":"0","rotate_z":"0","skew":"0","scale":"100"}},"textDescriptionArea":{"text_align":"Center","backgroundColor":{"color":"#60cb1b","opacity":"0"},"transform":{"translate_x":"0","translate_y":"0","rotate_x":"0","rotate_y":"0","rotate_z":"0","skew":"0","scale":"100"},"animate":{"duration":"0","timing_function":"ease-in-out","delay":"0","iteration_count":"0","direction":"alternate","fames":"from {-webkit-transform:scale(0.5);;background: rgba(96, 203, 27,0.5);-webkit-box-shadow: 0 0 5px rgba(255, 255, 255, 0.3) inset, 0 0 3px rgba(220, 120, 200, 0.5);color: red; }25% {background: rgba(196, 203, 27,0.8);-webkit-box-shadow: 0 0 10px rgba(255, 155, 255, 0.5) inset, 0 0 8px rgba(120, 120, 200, 0.8);color: blue;}50% {background: rgba(196, 203, 127,1);-webkit-box-shadow: 0 0 5px rgba(155, 255, 255, 0.3) inset, 0 0 3px rgba(220, 120, 100, 1);color: orange;}75% {background: rgba(196, 203, 27,0.8);-webkit-box-shadow: 0 0 10px rgba(255, 155, 255, 0.5) inset, 0 0 8px rgba(120, 120, 200, 0.8);color: black;}to {-webkit-transform:scale(1.1);;background: rgba(96, 203, 27,0.5);-webkit-box-shadow: 0 0 5px rgba(255, 255, 255, 0.3) inset, 0 0 3px rgba(220, 120, 200, 0.5);color: green;}"}},"textDescriptionText":{"font":{"fontSize":"12","lineHeight":"110","fontFamily":"Microsoft Yahei","color":"#000000"},"backgroundColor":{"color":"#60cb1b","opacity":"0"},"transform":{"translate_x":"0","translate_y":"0","rotate_x":"0","rotate_y":"0","rotate_z":"0","skew":"0","scale":"100"}},"btnArea":{"text_align":"Center","backgroundColor":{"color":"#60cb1b","opacity":"0"},"transform":{"translate_x":"0","translate_y":"0","rotate_x":"0","rotate_y":"0","rotate_z":"0","skew":"0","scale":"100"},"animate":{"duration":3,"timing_function":"ease-in-out","delay":"0","iteration_count":"0","direction":"alternate","fames":"from {-webkit-transform:scale(0.5);;background: rgba(96, 203, 27,0.5);-webkit-box-shadow: 0 0 5px rgba(255, 255, 255, 0.3) inset, 0 0 3px rgba(220, 120, 200, 0.5);color: red; }25% {background: rgba(196, 203, 27,0.8);-webkit-box-shadow: 0 0 10px rgba(255, 155, 255, 0.5) inset, 0 0 8px rgba(120, 120, 200, 0.8);color: blue;}50% {background: rgba(196, 203, 127,1);-webkit-box-shadow: 0 0 5px rgba(155, 255, 255, 0.3) inset, 0 0 3px rgba(220, 120, 100, 1);color: orange;}75% {background: rgba(196, 203, 27,0.8);-webkit-box-shadow: 0 0 10px rgba(255, 155, 255, 0.5) inset, 0 0 8px rgba(120, 120, 200, 0.8);color: black;}to {-webkit-transform:scale(1.1);;background: rgba(96, 203, 27,0.5);-webkit-box-shadow: 0 0 5px rgba(255, 255, 255, 0.3) inset, 0 0 3px rgba(220, 120, 200, 0.5);color: green;}"}},"btnContent":{"content":"查看","font":{"fontSize":"12","lineHeight":"110","fontFamily":"Microsoft Yahei","color":"#000000"},"backgroundColor":{"color":"#60cb1b","opacity":"0"},"transform":{"translate_x":"0","translate_y":"0","rotate_x":"0","rotate_y":"0","rotate_z":"0","skew":"0","scale":"100"}}},"scale":{"from":75,"to":352,"layout":{"iconArea":0,"textArea":1,"btnArea":2}}}}
);
//console.log(js);
process.exit();*/
