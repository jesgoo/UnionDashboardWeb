/**
 * @file Generated by er-sync
 * @author killeryyl<longgeyang@jesgoo.com>
 * @date Thu Jul 28 2016 16:51:30 GMT+0800 (CST)
 * Copyright (c) 2015 jesgoo.com, Inc. All Rights Reserved
 */
(function () {
    mf.index.media.siteExperiment = new er.Action({
        model: mf.index.media.model.siteExperiment,
        view: new er.View({
            template: 'mf_index_media_siteExperiment',
            UI_PROP: {}
        }),
        STATE_MAP: {},

        onenter: function () {
            console.log('onenter');
            mf.onenter();
        },
        onafterrepaint: function () {
            console.log('onafterrepaint');
        },
        onafterrender: function () {
            console.log('onafterrender');
        },
        onentercomplete: function () {
            console.log('onentercomplete');
            mf.loaded();
            var action = this;
            var model = action.model;
            var requestData = model.get('requestData');
            var editor = ace.edit("editor");
            editor.session.setMode("ace/mode/json");
            editor.setTheme("ace/theme/tomorrow");
            editor.setValue(requestData && JSON.stringify(requestData, null, 4) || '', 1);
            
            action.setValue = function () {
                var data = editor.getValue() || '{}';
                try {
                    data = JSON.parse(data);
                } catch (e) {
                    esui.Dialog.alert({
                        title: '错误提示',
                        content: 'JSON数据格式有误，请检查<br>' + e
                    });
                    return false;
                }
                return data;
            };
            action.formatJSON = function () {
                var data = editor.getValue() || '';
                data = data.replace(/^\s|\s$/g, '');
                if (!data) {
                    return false;
                }
                try {
                    data = JSON.parse(data);
                } catch (e) {
                    esui.Dialog.alert({
                        title: '错误提示',
                        content: 'JSON数据格式有误，请检查<br>' + e
                    });
                    return false;
                }
                editor.setValue(JSON.stringify(data, null, 4) || '', 1);
            };
            action.sample = function () {
                editor.setValue(JSON.stringify({
                        "Children": [
                            {
                                "Marks": [
                                    {
                                        "Name": "splash",
                                        "Value": {
                                            "on": false
                                        }
                                    }
                                ],
                                "Name": "不展现开屏"
                            },
                            {
                                "Name": "保持不变"
                            }
                        ],
                        "Name": "回避北上广",
                        "Router": {
                            "FeatureNames": [
                                "request.ProvinceName"
                            ],
                            "Type": "EqualString",
                            "Values": [
                                [
                                    "北京",
                                    "上海",
                                    "广州",
                                    "未知省份"
                                ]
                            ]
                        }
                    }, null, 4) || '', 1);
            };
        },
        onleave: function () {
            console.log('onleave');
        }
    });
})();