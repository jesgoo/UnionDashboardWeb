/**
 * @file Generated by er-sync
 * @author killeryyl<longgeyang@jesgoo.com>
 * @date Tue Mar 31 2015 10:59:06 GMT+0800 (CST)
 * Copyright (c) 2015 jesgoo.com, Inc. All Rights Reserved
 */
(function () {

    mf.index.report.dailyMedias = new er.Action({
        model: mf.index.report.model.dailyMedias,
        view: new er.View({
            template: 'mf_index_report_dailyMedias',
            UI_PROP: {
                dailyMediasDateRegion: {
                    range: mf.index.reportRange
                }
            }
        }),
        STATE_MAP: {
            'dateRegion':  mf.getDateString(mf.getDate(-7)) + ',' +
                           mf.getDateString(mf.getDate(-1)),
            page: 0,
            pageSize: mf.PAGER_MODEL.pageSizes[0].value,
            pageSizes: mf.PAGER_MODEL.pageSizes
        },

        onenter: function () {
            console.log('onenter');
            mf.onenter();
        },
        onafterrepaint: function () {
            console.log('onafterrepaint');
        },
        onafterrender: function () {
            console.log('onafterrender');
            var action = this;
            var model = action.model;

            var dateRegion = esui.get('dailyMediasDateRegion');
            dateRegion.onchange = mf.m.utils.nextTickWrapper(function (value, name, index) {
                console.log('date change', name, index);
                mf.subActionRefresh(action, {
                    dateRegion: dateRegion.getValue()
                });
            }, dateRegion);

            var dailyMediasDateSelect = esui.get('dailyMediasDateSelect');
            dailyMediasDateSelect.onchange = function (values, value) {
                mf.mockPager(model.get('reportData')[value], {
                    pager: esui.get('dailyMediasPager'),
                    pageSizer: esui.get('dailyMediasPageSize'),
                    table: esui.get('dailyMediasList')
                })();
            };
        },
        onentercomplete: function () {
            console.log('onentercomplete');
            var action = this;
            var model = action.model;
            var dailyMediasDateSelect = esui.get('dailyMediasDateSelect');
            dailyMediasDateSelect.setValue(dailyMediasDateSelect.datasource[0].id, { dispatch: true });
            mf.m.highchart_medias('#dailyMediasChart', model.get('reportData'));
        },
        onleave: function () {
            console.log('onleave');
        }
    });
})();