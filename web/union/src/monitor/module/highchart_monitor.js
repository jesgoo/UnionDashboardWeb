/**
 * @file Generated by er-sync, module
 * @author killeryyl<longgeyang@jesgoo.com>
 * @date Thu Apr 09 2015 17:17:07 GMT+0800 (CST)
 * Copyright (c) 2015 jesgoo.com, Inc. All Rights Reserved
 * shortcut mf.m.highchart_monitor
 */
(function (exports, module) {
    var oneDay = 1000 * 60 * 60 * 24;
    function getTime(dateChange) {
        var d = new Date();
        d = (Math.floor(d / oneDay) + (dateChange || 0)) * oneDay;
        return d;
    }
    function getTimeString(timeNumber) {
        var timeObj = new Date(timeNumber);
        var date = ('0' + timeObj.getDate()).substr(-2);
        return date;
    }
    var highchart_monitor = function (element, cData, opt) {
        console.log('chart original', element, cData);

        var startDate = new Date(((+cData.time.slice(-1)[0] + 2) * 60000) - oneDay);
        var UTCStartDate = Date.UTC(
            startDate.getFullYear(),
            startDate.getMonth(),
            startDate.getMonth(),
            startDate.getHours(),
            startDate.getMinutes()
        );
        console.log(UTCStartDate, cData.time.slice(-1)[0], cData.time.slice(-1)[0] * 60000 - oneDay);
        var serials = $.map(cData.data, function (data, index){
            return {
                name: getTimeString(getTime(-index)) + '号',
                type: 'spline',
                yAxis: 0,
                pointInterval: 2 * 60 * 1000,
                pointStart: UTCStartDate,
                data: data,
                lineWidth: 2,
                tooltip: {
                    valueSuffix: ' 次'
                }
            }
        });
        return $(element).highcharts({
            chart: {
                animation: false,
                spacingTop: 60,
                marginTop: 60,
                zoomType: 'x'
            },
            colors: ["#f6505c", "#1c62b8", "#f6c928", "#19b2b7", "#8772cd", "#eb6f25"],
            credits: {
                enabled: false
            },
            exporting: {
                enabled: false
            },
            tooltip: {
                shared: true,
                crosshairs: {
                    width: 2,
                    color: 'gray',
                    dashStyle: 'shortdot'
                }
            },
            title: {
                text: null
            },
            legend: {
                title: {
                    text: opt.name
                },
                align: 'right',
                layout: 'vertical',
                verticalAlign: 'top',
                //itemMarginTop: -45,
                itemMarginTop: 10,
                floating: false,
                itemStyle: {
                    fontWeight: 'normal',
                    color: '#777',
                    fontSize: 12,
                    symbolPadding: 10
                },
                itemDistance: 20
            },
            plotOptions: {
                line: {
                    marker: {
                        symbol: 'circle',
                        radius: 2
                    },
                    lineWidth: 1
                },
                spline: {
                    marker: {
                        enabled: false
                    }
                }
            },
            xAxis: {
                type: 'datetime',
                maxZoom: 3600 * 1000,
                //minRange: 3600 * 1000,
                //categories: cData.time,
                lineColor: '#e5e5e5',
                tickColor: '#e5e5e5',
                labels: {
                    style: {
                        color: '#7a7a7a'
                    },
                    //rotation: -30,
                    align: 'right'
                },
                tickPosition: 'inside',
                tickLength: 4,
                tickmarkPlacement: 'on'
            },
            yAxis: [
                { // Secondary yAxis
                    //min: 0,
                    gridLineWidth: 1,
                    title: {
                        text: null
                    },
                    labels: {
                        align: 'right',
                        formatter: function () {
                            if (this.value > 10000) {
                                return Math.round(this.value / 1000) / 10 + '万次';
                            } else {
                                return this.value + '次';
                            }
                        },
                        enabled: true
                    }

                }
            ],
            series: serials
        }).highcharts();
    };
    exports.highchart_monitor = highchart_monitor;
})(mf && mf.m || exports || {}, mf || module);