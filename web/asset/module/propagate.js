/**
 * @file Generated by er-sync, module
 * @author Luics<xukai01@baidu.com>
 * @date Wed Sep 25 2013 16:39:20 GMT+0800 (中国标准时间)
 * Copyright (c) 2012 Baidu.com, Inc. All Rights Reserved
 * 首页宣传所用js
 * shortcut mf.m.Propagate
 */
(function(exports, module) {
    var propagate = function (opt) {
        var settings = {
            pop: 'myPop'
        };
        var pop = document.getElementById(settings.pop);
        var nowStamp, nowTimes;
        if (!pop) return;
        $(pop).addClass('mf-propagate');
        if (opt.noBorder) $(pop).addClass('mf-propagate-noBd');

        this.set = function (cfg) {
            cfg = cfg || {};
            $(pop).width(cfg.width || 600).height(cfg.height || 500);
            var l = $(window).width() - $(pop).width();
            var t = $(window).height() - $(pop).height();
            $(pop).css({
                left: (l > 0 ? l / 2 : 0),
                top: (t > 0 ? t / 2 : 0)
            });
            return this;
        };

        this.src = function (model) {
            var frag = document.createDocumentFragment();
            for (var i = 0; i < model.length; ++i) {
                var tp = model[i].type;
                var ele = document.createElement(tp);
                var url = model[i].content;
                if (tp === 'img') {
                    ele.src = url;
                    if (model[i].width) ele.width = model[i].width;
                    if (model[i].height) ele.height = model[i].height;
                }
                else ele.innerHTML = url;
                frag.appendChild(ele);
            }
            var btn = document.createElement('div');
            btn.className = 'submit';
            var me = this;
            btn.onclick = function () {
                baidu.cookie.set(opt.id, nowStamp + ' ' + nowTimes);
                me.hide();
                if (opt.callback) opt.callback();
            };
            frag.appendChild(btn);
            pop.appendChild(frag);
            return this;
        };

        this.hide = function () {
            esui.Mask.hide();
            $('select').css("visibility", "visible");
            $(pop).hide();
            return this;
        };

        this.show = function () {
            esui.Mask.show('', 'gray');
            $('select').css("visibility", "hidden");
            $(pop).show();
            return this;
        };

        this.init = function (config) {
            var cookie = baidu.cookie.get(opt.id);
            var isShow = false;
            var t = config.times - 1;
            if (!cookie) {
                cookie = config.stamp + ' ' + t;
                baidu.cookie.set(opt.id, cookie);
                isShow = true;
                nowTimes = t;
            } else {
                var stamp = cookie.substring(0, cookie.indexOf(' '));
                var times = cookie.substring(1 + cookie.indexOf(' '));
                if (config.stamp !== stamp) {
                    baidu.cookie.set(opt.id, config.stamp + ' ' + t);
                    isShow = true;
                    nowTimes = t;
                } else {
                    nowTimes = parseInt(times, 10) - 1;
                    baidu.cookie.set(opt.id, stamp + ' ' + nowTimes);
                    if (nowTimes >= 0) isShow = true;
                }
            }
            nowStamp = config.stamp;
            if (isShow) this.set(opt).src(config.data).show();
            else if (opt.callback) opt.callback();
        };
    };
    exports.propagate = propagate;
})(mf && mf.m || exports || {}, mf || module);